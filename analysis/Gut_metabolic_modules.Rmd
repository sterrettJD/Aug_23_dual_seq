---
title: "Gut-Metabolic-Modules"
author: "John Sterrett"
date: "2023-11-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

pacman::p_load("tidyverse",
               "ggplot2")
# set ggplot theme
theme_set(theme_bw())

```

# Load data
```{r}
ko <- data.table::fread("../seq.f0.0.r0.0.nonhost.humann/all_genefamilies_ko_named.tsv",
                        data.table=F)
rownames(ko) <- ko$`# Gene Family`
ko$`# Gene Family` <- NULL
ko <- ko %>% mutate_all(as.numeric)
colnames(ko) <- colnames(ko) %>% 
    gsub(pattern="_Abundance-RPKs", replacement="")

ko.tax.rows <- rownames(ko) %>% grepl(pattern="\\|")
ko.notax <- ko[!ko.tax.rows,]
ko.tax <- ko[ko.tax.rows,]

metadata <- data.table::fread("../16s-data/16S_meta.txt",
                        data.table=F)

# Samples before DM 33 were stored in PBS, all others (including LG)
is.DM <- grepl("DM", metadata$Sample_ID)
number <- str_split(metadata$Sample_ID, pattern="_") %>% 
    lapply(function(x){x[2]}) %>% 
    unlist() %>% 
    as.numeric()

metadata$storage_method <- rep(NA, nrow(metadata)) %>% as.character()
metadata[((number < 33) & (is.DM)), "storage_method"] <- "PBS"
metadata[is.na(metadata$storage_method), "storage_method"] <- "RNALater"

metadata[is.DM, "Participant"] <- paste0("DM_", number[is.DM])
metadata[!is.DM, "Participant"] <- paste0("LG_", number[!is.DM])

metadata %>% 
    group_by(Participant) %>% 
    summarise(MSM=first(MSM)) %>%
    select(MSM) %>%
    as.data.frame() %>%
    mutate(MSM=as.factor(MSM)) %>%
    summary()

```

# Pull Gut Metabolic Modules
```{r}


```